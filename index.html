<html>
    <head>
        <link rel="icon" type="image/x-icon" href="https://cdn.discordapp.com/attachments/747598678449061992/1072067659446882304/circle_icon_231193.ico">
        <title id="title">discord2 (unauthorized)</title>
        
        <meta id="intrest-cohortBugfix" http-equiv="Permissions-Policy" content="interest-cohort=()">

        <style>
            .serverIcon {width:40; height:40; border-radius:30px; flex-grow:0;}

            .hiddenScrollBar::-webkit-scrollbar {display: none;}
            .hiddenScrollBar {-ms-overflow-style: none; scrollbar-width: none;}

            .flexScroller {overflow-y:auto; flex-shrink:1;}
        </style>
    </head>

    <body id ="body" class="hiddenScrollBar" style="min-width:800; margin:0; padding:0;">
        <div id="main" style="height:100%; display:flex; flex-direction:row;">
            <div id="serverMenu" style="display:flex; flex-direction:column; width:50; height:100%; top:0; left:0;   flex-grow:0; background-color:#282b30;">
                <div style="width:40; height:40; flex-grow:0; padding:5;">
                    <div id="directMessages" class="serverIcon" style="background-color:#ffffff;"></div>
                </div>

                <div id="servers" class="hiddenScrollBar flexScroller" style="width:40; height: 100%; padding:5;">
                </div>

                <div style="width:40; height:40; flex-grow:0; padding:5;">
                    <div id="addServer" class="serverIcon" style="background-color:#ffffff;"></div>
                </div>
            </div>

            <div id="menu"    style="display:flex; flex-direction:column; min-width:250;   height:100%; top:0; left:50;  flex-grow:0; background-color:#36393e;">
                <div id="serverName" style="width:100%; height:50;   flex-grow:0;">
                    <div>
                    Some Server
                    </div>
                </div>
                <div id="channels"   style="width:100%; height:auto; flex-grow:1;"></div>
                <div id="userName"   style="display:flex; flex-direction:row; width:100%; height:50;   flex-grow:0;">
                    <div style="flex-grow:1;">Some User</div>
                    <div style="width:50; height:50;"></div>
                </div>
            </div>

            <div id="content" style="display:flex; flex-direction:column; width:auto;  height:100%; top:0; left:150; flex-grow:1; background-color:#424549;">
                <div id="channelName" style="width:100%; height:50;   flex-grow:0;"></div>
                <div id="sheetsAccess" style="display:none;">
                    <button id="auth">auth</button>
                    <button id="read">read</button>
                    <button id="write">write</button>
                    <span contenteditable="true" id="range" style="background-color:#ffffff"></span>
                </div>
                <div id="messages"    style="width:100%; height:auto; flex-grow:1;"></div>
                <div id="messageBox"  style="width:100%; height:75;   flex-grow:0;"></div>
            </div>

            <div id="users"  style="display:flex; flex-direction:column;  width:200;   height:100%; top:0; right:0;  flex-grow:0; background-color:#36393e;">
                <div id="userSearch" style="width:100%; height:50; flex-grow:0;"></div>
                <div id="usersList"  style="width:100%; height:auto; flex-grow:1;"></div>
            </div>
        </div>
    </body>

    <script>
        const serverMenu      = document.getElementById("serverMenu");
        const directMessages  = document.getElementById("directMessages");
        const servers         = document.getElementById("servers");
        const addServerButton = document.getElementById("addServer");
        const read            = document.getElementById("read");
        const write           = document.getElementById("write");
        const input           = document.getElementById("range");
        var handledAuth = false;
    </script>
    
    <script>
        read.onclick = async () => {
            const values = await readData("1gEhqSyp75XrCDH8fHwVQYD9EeXNpSTAsaN49U4brg8o", input.innerText);
            input.innerText = "";
            console.log(values[0]);
        };
        
        write.onclick = () => {
            writeData("1gEhqSyp75XrCDH8fHwVQYD9EeXNpSTAsaN49U4brg8o", "A1", [[input.innerText]]);
            input.innerText = "";
        };
        
        addServerButton.onclick = () => {
            // bring up addServer menu, ask for database id, then add server based on db id and shared members
            addServer("blank");
        };
        
        async function readData(spreadsheetId, range) {
            const res = await gapi.client.sheets.spreadsheets.values.get({spreadsheetId: spreadsheetId,range: range,});
            return res.result.values;
        }
        
        // values ex: [[value1, value2],[value3, value4]]
        async function writeData(spreadsheetId, range, values) {
            try {
                gapi.client.sheets.spreadsheets.values.update({
                    spreadsheetId: spreadsheetId,
                    range: range,
                    valueInputOption: "RAW",
                    resource: {values: values},
                }).then((response) => {
                    const result = response.result;
                    console.log("${result.updatedCells} cells updated.");
                });
            } catch (err) {
                console.log(err.message);
                return;
            }
        }
        
        function addServer(name) {
            const server = document.createElement("div");
            server.id = name;
            server.className = "serverIcon";
            server.style = "background-color:#"+Math.floor(Math.random()*16777215).toString(16)+";";


            server.onclick = () => {
                server.parentNode.removeChild(server);
                serverDivider.parentNode.removeChild(serverDivider);
            }

            const serverDivider = document.createElement("div");
            serverDivider.style = "height:5;";

            servers.appendChild(server);
            servers.appendChild(serverDivider);
        }
    </script>
    
    <script>
        let tokenClient;
        let gapiInited = false;
        let gInited = false;
       
        function gapiLoaded() {
            gapi.load('client', async () => {
                await gapi.client.init({
                    apiKey: "AIzaSyAOUjID5aZreP7DmXJjWL0B26Ej6JTu9LI", 
                    discoveryDocs: ["https://sheets.googleapis.com/$discovery/rest?version=v4"]
                });
            });
            gapiInited = true;
            tryHandleAuth();
        }
        
        function gLoaded() {
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: "889192406698-a437s18o4v6hlhlm58gf41hc52tg9i58.apps.googleusercontent.com",
                scope: "https://www.googleapis.com/auth/spreadsheets",
                callback: ""
            });
            gInited = true;
            tryHandleAuth();
        }
        
        function tryHandleAuth() {
            if (gapiInited && gInited) {
                handleAuth();
            }
        }
                
        function handleAuth() {
            tokenClient.callback = async (resp) => {if (resp.error !== undefined) {throw (resp);}}; 
            tokenClient.requestAccessToken({prompt: "consent"});
            document.getElementById("title").innerText = "discord2";
            document.getElementById('sheetsAccess').style = "display:flex; flex-direction:column;";
        }
        
        document.getElementById("auth").onclick = () => {handleAuth();};
        
        
    </script>
    
    <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
    <script async defer src="https://accounts.google.com/gsi/client" onload="gLoaded()"></script>

</html>
